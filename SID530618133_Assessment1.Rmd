---
title: "Reef_Assignment"
output: 
  html_document:
    theme: journal
date: "2025-03-11"
author: "530618133"
bibliography: citations.bib
---

# DATA3888 Assignment: Reef

```{r, include=FALSE}
library(viridis)
library(tidyverse)
library(ncdf4)
library(ggmap)

register_google(key = "AIzaSyAnwb9-OeK8El-HX0ZP19N437-G6chspAU", write = TRUE)
```

## Part One

## Looking Into Yearly Data on Average Bleaching

```{r, include=FALSE}
countryData <- read.csv("Reef_Check_with_cortad_variables_with_annual_rate_of_SST_change.csv")

countryDataYears <- filter(countryData, Year >= 2014 & Year < 2018)
```

```{r, echo=FALSE}
library(gridExtra) # For arranging plots in a grid
plots <- list()
for (x in 2014:2017) {
  countryDataYears <- filter(countryData, Year == x)
  tsa_model <- countryDataYears[, c("Reef.Name", "Year", "Latitude.Degrees", "Longitude.Degrees","Average_bleaching")]
  tsa_model <- tsa_model %>% distinct(Reef.Name, Year, Latitude.Degrees, Longitude.Degrees, Average_bleaching)
  
  tsa_model <- transform(tsa_model, in_zone = ifelse(abs(Latitude.Degrees)<20 & abs(Latitude.Degrees)>15, "Inbetween", ifelse(abs(Latitude.Degrees)<15, "Inside Midlatitude Zone", "Outside Midlatitude Zone")))
  
  tsa_model <- tsa_model %>% arrange(!(Average_bleaching <= 4.32))
          
  tsa_model$in_zone <- as.factor(tsa_model$in_zone)
  
  world_map <- map_data("world")
  p <- ggplot()+geom_polygon(data =world_map, aes(x=long, y = lat, group = group), alpha=0.3)+
  geom_point(data = tsa_model, alpha = 0.5, aes(y=Latitude.Degrees, x= Longitude.Degrees,
    color=Average_bleaching>4.32), size=4) +  geom_hline(yintercept = -15, color = "red", linetype = "dashed", linewidth = 1)+  geom_hline(yintercept = 15, color = "red", linetype = "dashed", linewidth = 1)+scale_colour_viridis_d(option = "D") + theme_minimal() +  theme(
      panel.background = element_rect(color = "black"), plot.background = element_rect(fill = "lightblue4", color = NA)) + ggtitle(paste("Year:", x)) + labs(color = "Average", shape = "Reef Above Mean") + xlab("Longitude") + ylab("Latitude")
  plots[[as.character(x)]] <- p
}

grid.arrange(grobs = plots, ncol = 2)
```

```{r, echo=FALSE}
countryDataYears <- filter(countryData, Year >=2014 & Year < 2018)
tsa_model <- countryDataYears[, c("Reef.Name", "Year", "Latitude.Degrees", "Longitude.Degrees","Average_bleaching")]

tsa_model <- transform(tsa_model, in_zone = ifelse(abs(Latitude.Degrees)<20 & abs(Latitude.Degrees)>15, "Inbetween", ifelse(abs(Latitude.Degrees)<15, "Inside Midlatitude Zone", "Outside Midlatitude Zone")))

tsa_model$in_zone <- as.factor(tsa_model$in_zone)
  
comparing_tsa <- tsa_model[, c("Year","in_zone", "Average_bleaching")]

p <- comparing_tsa %>% group_by(Year, in_zone) %>%
  summarise(average_value = mean(Average_bleaching, na.rm=TRUE), .groups = "drop")

ggplot(p, aes(x=Year, y = average_value, color = in_zone)) + geom_line(linewidth = 3) + scale_colour_viridis_d() + ggtitle("Comparing Average Bleaching with Years and Zone")
```

# Part 2
```{r, echo=FALSE}
eReefs_nc = ncdf4::nc_open(
"https://thredds.ereefs.aims.gov.au/thredds/dodsC/
GBR4_H2p0_B3p1_Cq3b_Dhnd/annual.nc?zc[1],
latitude[0:1:722],longitude[0:1:490],
temp[0:1:9][1][0:1:722][0:1:490],
TOTAL_NITROGEN[0:1:9][1][0:1:722][0:1:490],
MA_N[0:1:9][0:1:722][0:1:490],
PH[0:1:9][1][0:1:722][0:1:490],
salt[0:1:9][1][0:1:722][0:1:490],
time[0:1:9]")

# Access latitude and longitude
latitude <- ncvar_get(eReefs_nc, "latitude")
longitude <- ncvar_get(eReefs_nc, "longitude")

# View the first few values of latitude and longitude
head(latitude)
head(longitude)
```